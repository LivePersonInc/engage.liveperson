window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag._tagv='2.9.0';lpTag.log=function(msg,type,app){lpTag._logcnt=lpTag._logcnt||0;if(typeof(lpMTagDebug)!='undefined'&&typeof(lpMTagDebug.Display)=='function'){lpMTagDebug.Display(msg,type,app,lpTag._logcnt)}if(typeof(lpTaglogListeners)!='undefined'){for(var i=0;i<lpTaglogListeners.length;i++){try{lpTaglogListeners[i](msg,type,app,lpTag._logcnt)}catch(e){if(typeof(lpMTagDebug)!='undefined'&&typeof(lpMTagDebug.Display)=='function'){lpMTagDebug.Display('Exception='+e+' msg='+msg,type,app,lpTag._logcnt)}}}}lpTag._logcnt++};lpTag.csds=(function(){var srvMap=[],setDomains=function(_srvMap){for(var i=0;i<_srvMap.length;i++){srvMap[_srvMap[i].service]=_srvMap[i].baseURI}};var getDomain=function(srv){var baseURI=srvMap[srv];if(baseURI){return baseURI}return srvMap['ALL']};var getCSDSMap=function(){return srvMap};return{getDomain:getDomain,setDomains:setDomains,getCSDSMap:getCSDSMap}})();lpTag.getDomain=lpTag.csds.getDomain;lpTag.events=(function(){var eventId=0,lstnrs={},fired=[],prefix='evId_',lpt_domReady_hasTriggered=false,bind=function(app,ev,fn){if(!app||!ev||typeof(fn)!='function'){lpTag.log('bind invalid params:  app=['+app+'] ev=['+ev+']  fn=['+fn+']','ERROR','EVENTS');return null}var evId=eventId++;lstnrs[prefix+evId]={id:evId,name:ev,app:app,fn:fn};lpTag.log('ev: '+ev+',  app: '+(app||'*')+'bind','DEBUG','EVENTS');return evId};var unbind=function(id){if(!id){lpTag.log('Ev listen id not spec for unbind','ERROR','EVENTS');return null}var ev=lstnrs[prefix+id];if(typeof(ev)=='undefined'){lpTag.log('Ev listen id not Found for unbind id='+id,'ERROR','EVENTS');return false}else{delete lstnrs[prefix+id];lpTag.log('Ev listen id='+id+' unbind','DEBUG','EVENTS');return true}};var hasFired=function(app,evName){if(app=='*'&&evName=='*'){return fired}var ret=[];for(var n=0;n<fired.length;n++){if((app=='*'||fired[n].app==app)&&(evName=='*'||fired[n].evName==evName)){ret.push(fired[n])}}return ret};var trigger=function(app,evName,data){if(typeof(evName)=='undefined'||typeof(app)=='undefined'){lpTag.log('Ev name or app not spec for trigger','ERROR','EVENTS');return}if(app=='LPT'&&evName=='DOM_READY'){if(lpt_domReady_hasTriggered){return}lpt_domReady_hasTriggered=true}if(typeof(lpTag._deferExecuted)==='undefined'){lpTag.defer(function(){lpTag.events.trigger(app,evName,data)},1);return}fired.push({"app":app,"evName":evName,"data":data});for(var n in lstnrs){var l=lstnrs[n];if((l.name==evName||l.name=='*')&&(l.app=='*'||l.app==app)){try{var ev={"app":app,"name":evName};l.fn(data,ev);lpTag.log('app='+app+' ev='+evName+' triggered','DEBUG','EVENTS')}catch(err){lpTag.log('Error triggering  '+evName,'DEBUG','EVENTS')}}}};return{bind:bind,unbind:unbind,hasFired:hasFired,trigger:trigger}})();lpTag.tglMng=(function(){var run=function(taglets){_createTaglets(taglets);try{taglets=_sortIncludes(taglets)}catch(e){lpTag.log("Exception in _manageIncludes:"+e,'ERROR','LPTAG')}_initTaglets(taglets);_execDefers();lpTag.events.trigger('LPTAG','ON_READY');_startTaglets(taglets);lpTag.events.trigger('LPTAG','ON_STARTED')};var _sortIncludes=function(taglets){var tgl_list=[],tgl_obj={};for(var i=0;i<taglets.length;i++){var t=lpTag.taglets[taglets[i].name];if(typeof(t.includes)!='undefined'&&typeof(t.includes.length)=='undefined'){t.includes=[t.includes]}tgl_obj[taglets[i].name]=lpTag.taglets[taglets[i].name].includes}var cnt=0,isNotEmpty=true;while(isNotEmpty){cnt++;isNotEmpty=false;for(var name in tgl_obj){if(typeof(tgl_obj[name])=='undefined'||(typeof(tgl_obj[name])!='undefined'&&tgl_obj[name].length==0)){tgl_list.push(_getTaglet(taglets,name));delete tgl_obj[name];tgl_obj=_removeFromIncludes(tgl_obj,name)}isNotEmpty=true}if(cnt>(taglets.length+1)){var msg='';try{for(var n in tgl_obj){msg+='# tgl=['+n+'] missing -> ';for(var i=0;i<tgl_obj[n].length;i++){msg+=' '+tgl_obj[n][i].name}}}catch(e){lpTag.log('Exception in sortInclude:'+e,'ERROR','LPTAG')}lpTag.log('Missing/circular includes:'+msg,'ERROR','LPTAG');isNotEmpty=false}}return tgl_list};function _getTaglet(tgls,name){for(var i=0;i<tgls.length;i++){if(tgls[i].name==name){return tgls[i]}}return undefined}function _removeFromIncludes(arr,name){for(var n in arr){var inc=arr[n];if(typeof(inc)!='undefined'){var tmp=[];for(var i=0;i<inc.length;i++){if(inc[i].name!=name){tmp.push(inc[i])}}arr[n]=tmp}}return arr}var _createTaglets=function(taglets){for(var i=0;i<taglets.length;i++){try{lpTag.log('Processing taglet: '+taglets[i].name,'DEBUG','LPTAG');eval(taglets[i].code)}catch(e){lpTag.log('Error creating taglet:'+taglets[i].name+'  e='+e,'ERROR','LPTAG')}}};var _initTaglets=function(taglets){for(var i=0;i<taglets.length;i++){var tgl=lpTag.taglets[taglets[i].name];try{lpTag.log('Init taglet: '+taglets[i].name,'DEBUG','LPTAG');tgl.init(taglets[i].parameters)}catch(e){lpTag.log('Error init taglet:'+taglets[i].name+'  e='+e,'ERROR','LPTAG')}}};var _execDefers=function(){lpTag._deferExecuted=true;lpTag.defer=function(fn){try{fn()}catch(e){lpTag.log('Error executing defer fn:'+e,'ERROR','LPTAG')}};_execDeferArr(lpTag._defB);_execDeferArr(lpTag._defT);_execDeferArr(lpTag._defL)};var _execDeferArr=function(_defArr){if(typeof _defArr!=='undefined'){for(var i=0;i<_defArr.length;i++){try{_defArr[i]()}catch(e){lpTag.log('Error executing defer fn:'+e,'ERROR','LPTAG')}}_defArr.length=0}};var _startTaglets=function(taglets){for(var i=0;i<taglets.length;i++){var tgl=lpTag.taglets[taglets[i].name];try{if((typeof(tgl.start)==='function')){lpTag.log('Start taglet: '+taglets[i].name,'DEBUG','LPTAG');tgl.start()}lpTag.events.trigger('LPTAG','TAGLET_STARTED',{"name":taglets[i].name})}catch(e){lpTag.log('Error start taglet :'+taglets[i].name+'e= '+e,'ERROR','LPTAG')}}};return{run:run}})();lpTag.start=function(){lpTag.load(lpTag.protocol+'//'+((lpTag.ovr&&lpTag.ovr.tagjs)?lpTag.ovr.tagjs:'tags.liveperson.net')+'/lptag/api/account/'+lpTag.site+'/configuration/applications/taglets/.jsonp'+(lpTag.section?"?s="+lpTag.section:""),'UTF-8')};lpTag.callback=function(response){try{lpTag.csds.setDomains(response.serviceMap);lpTag.tglMng.run(response.taglets)}catch(e){lpTag.log('callback has failed '+e,'ERROR','LPTAG')}};lpTag.run=function(){if(typeof(window._lptTagStop)=='undefined'&&(typeof(lpTag.autoStart)=='undefined'||lpTag.autoStart)){lpTag.start()}};lpTag.run();